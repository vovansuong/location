<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GPS Location Tracker - ƒê·ªãnh v·ªã ch√≠nh x√°c</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    
    .header {
      background: linear-gradient(135deg, #4CAF50, #45a049);
      color: white;
      padding: 30px;
      text-align: center;
    }
    
    .header h1 {
      font-size: 28px;
      margin-bottom: 10px;
    }
    
    .header p {
      opacity: 0.9;
      font-size: 16px;
    }
    
    .content {
      padding: 30px;
    }
    
    .button-group {
      display: flex;
      gap: 15px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }
    
    button {
      flex: 1;
      min-width: 150px;
      padding: 15px 20px;
      font-size: 16px;
      font-weight: 600;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #FF6B6B, #FF8E53);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(255, 107, 107, 0.3);
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, #4ECDC4, #44A08D);
      color: white;
    }
    
    .btn-secondary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(78, 205, 196, 0.3);
    }
    
    .btn-clear {
      background: linear-gradient(135deg, #A8EDEA, #FED6E3);
      color: #333;
    }
    
    .btn-clear:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(168, 237, 234, 0.3);
    }
    
    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
    }
    
    .info-card {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 20px;
      border-left: 5px solid #4CAF50;
    }
    
    .status {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .coordinates {
      background: white;
      padding: 15px;
      border-radius: 10px;
      font-family: 'Courier New', monospace;
      font-size: 16px;
      border: 2px solid #e0e0e0;
      margin: 10px 0;
    }
    
    .address {
      background: #e8f5e8;
      padding: 15px;
      border-radius: 10px;
      font-size: 16px;
      line-height: 1.5;
      border: 2px solid #4CAF50;
      margin: 10px 0;
    }
    
    .accuracy {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 10px 0;
      padding: 10px;
      background: white;
      border-radius: 8px;
    }
    
    .accuracy-good { color: #4CAF50; }
    .accuracy-medium { color: #FF9800; }
    .accuracy-poor { color: #f44336; }
    
    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #4CAF50;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .map-links {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 15px;
    }
    
    .map-link {
      padding: 8px 15px;
      background: #2196F3;
      color: white;
      text-decoration: none;
      border-radius: 20px;
      font-size: 14px;
      transition: all 0.3s ease;
    }
    
    .map-link:hover {
      background: #1976D2;
      transform: translateY(-1px);
    }
    
    .error {
      background: #ffebee;
      color: #c62828;
      border-left-color: #f44336;
    }
    
    .loading {
      background: #fff3e0;
      color: #ef6c00;
      border-left-color: #ff9800;
    }
    
    .success {
      background: #e8f5e8;
      color: #2e7d32;
      border-left-color: #4CAF50;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üõ∞Ô∏è GPS Location Tracker</h1>
      <p>ƒê·ªãnh v·ªã ch√≠nh x√°c b·∫±ng GPS v·ªõi ƒë·ªô ch√≠nh x√°c cao</p>
    </div>
    
    <div class="content">
      <div class="button-group">
        <button class="btn-primary" onclick="getHighAccuracyLocation()" id="btnGetLocation">
          üéØ L·∫•y v·ªã tr√≠ GPS
        </button>
        <button class="btn-secondary" onclick="watchLocation()" id="btnWatch">
          üì° Theo d√µi li√™n t·ª•c
        </button>
        <button class="btn-clear" onclick="clearResults()" id="btnClear">
          üóëÔ∏è X√≥a k·∫øt qu·∫£
        </button>
      </div>
      
      <div class="info-card" id="results">
        <div class="status">
          üîç S·∫µn s√†ng l·∫•y v·ªã tr√≠ GPS ch√≠nh x√°c
        </div>
        <p>Nh·∫•n n√∫t "L·∫•y v·ªã tr√≠ GPS" ƒë·ªÉ b·∫Øt ƒë·∫ßu ƒë·ªãnh v·ªã v·ªõi ƒë·ªô ch√≠nh x√°c cao.</p>
      </div>
    </div>
  </div>

  <script>
    let watchId = null;
    let isWatching = false;

    // C·∫•u h√¨nh GPS v·ªõi ƒë·ªô ch√≠nh x√°c cao nh·∫•t
    const highAccuracyOptions = {
      enableHighAccuracy: true,  // B·∫Øt bu·ªôc d√πng GPS
      timeout: 60000,           // Ch·ªù t·ªëi ƒëa 60 gi√¢y
      maximumAge: 0             // Kh√¥ng d√πng cache, lu√¥n l·∫•y v·ªã tr√≠ m·ªõi
    };

    // C·∫•u h√¨nh cho theo d√µi li√™n t·ª•c
    const watchOptions = {
      enableHighAccuracy: true,
      timeout: 30000,
      maximumAge: 10000  // Cache 10 gi√¢y cho watch mode
    };

    function updateStatus(message, type = 'info', showSpinner = false) {
      const results = document.getElementById('results');
      const statusDiv = results.querySelector('.status');
      
      // X√≥a c√°c class c≈©
      results.classList.remove('error', 'loading', 'success');
      
      // Th√™m class m·ªõi
      if (type === 'error') results.classList.add('error');
      if (type === 'loading') results.classList.add('loading');
      if (type === 'success') results.classList.add('success');
      
      // C·∫≠p nh·∫≠t n·ªôi dung
      statusDiv.innerHTML = showSpinner ? 
        `<span class="spinner"></span> ${message}` : 
        message;
    }

    function displayLocationInfo(position) {
      const { latitude, longitude, accuracy, altitude, heading, speed } = position.coords;
      const timestamp = new Date(position.timestamp);
      
      let accuracyClass = 'accuracy-poor';
      let accuracyText = 'K√©m';
      let accuracyIcon = 'üî¥';
      
      if (accuracy <= 10) {
        accuracyClass = 'accuracy-good';
        accuracyText = 'R·∫•t t·ªët';
        accuracyIcon = 'üü¢';
      } else if (accuracy <= 50) {
        accuracyClass = 'accuracy-medium';
        accuracyText = 'T·ªët';
        accuracyIcon = 'üü°';
      }
      
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = `
        <div class="status">
          üéØ ƒê√£ l·∫•y ƒë∆∞·ª£c v·ªã tr√≠ GPS ch√≠nh x√°c!
        </div>
        
        <div class="coordinates">
          <strong>üìç T·ªça ƒë·ªô:</strong><br>
          Vƒ© ƒë·ªô: ${latitude.toFixed(8)}<br>
          Kinh ƒë·ªô: ${longitude.toFixed(8)}
        </div>
        
        <div class="accuracy ${accuracyClass}">
          ${accuracyIcon} <strong>ƒê·ªô ch√≠nh x√°c:</strong> ${accuracy.toFixed(1)} m√©t (${accuracyText})
        </div>
        
        ${altitude ? `<div class="coordinates"><strong>üèîÔ∏è ƒê·ªô cao:</strong> ${altitude.toFixed(1)} m√©t</div>` : ''}
        ${speed ? `<div class="coordinates"><strong>üöÄ T·ªëc ƒë·ªô:</strong> ${(speed * 3.6).toFixed(1)} km/h</div>` : ''}
        ${heading ? `<div class="coordinates"><strong>üß≠ H∆∞·ªõng:</strong> ${heading.toFixed(1)}¬∞</div>` : ''}
        
        <div class="coordinates">
          <strong>üïê Th·ªùi gian:</strong> ${timestamp.toLocaleString('vi-VN')}
        </div>
        
        <div class="map-links">
          <a href="https://www.google.com/maps?q=${latitude},${longitude}" target="_blank" class="map-link">
            üó∫Ô∏è Google Maps
          </a>
          <a href="https://maps.apple.com/?q=${latitude},${longitude}" target="_blank" class="map-link">
            üçé Apple Maps  
          </a>
          <a href="https://www.openstreetmap.org/?mlat=${latitude}&mlon=${longitude}&zoom=18" target="_blank" class="map-link">
            üåç OpenStreetMap
          </a>
        </div>
      `;
      
      // Th·ª≠ reverse geocoding ƒë·ªÉ l·∫•y ƒë·ªãa ch·ªâ
      reverseGeocode(latitude, longitude);
    }

    async function reverseGeocode(lat, lng) {
      try {
        // S·ª≠ d·ª•ng Nominatim API (mi·ªÖn ph√≠, kh√¥ng c·∫ßn API key)
        const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&addressdetails=1&accept-language=vi`);
        const data = await response.json();
        
        if (data && data.display_name) {
          const addressDiv = document.createElement('div');
          addressDiv.className = 'address';
          addressDiv.innerHTML = `<strong>üìÆ ƒê·ªãa ch·ªâ:</strong><br>${data.display_name}`;
          
          const resultsDiv = document.getElementById('results');
          const mapLinks = resultsDiv.querySelector('.map-links');
          resultsDiv.insertBefore(addressDiv, mapLinks);
        }
      } catch (error) {
        console.log('Kh√¥ng th·ªÉ l·∫•y ƒë·ªãa ch·ªâ:', error);
        // Kh√¥ng hi·ªÉn th·ªã l·ªói cho ng∆∞·ªùi d√πng v√¨ ƒë√¢y ch·ªâ l√† t√≠nh nƒÉng ph·ª•
      }
    }

    function handleLocationError(error) {
      let message = '';
      let icon = '‚ùå';
      
      switch (error.code) {
        case error.PERMISSION_DENIED:
          message = "B·∫°n ƒë√£ t·ª´ ch·ªëi quy·ªÅn truy c·∫≠p v·ªã tr—ñ. Vui l√≤ng cho ph√©p truy c·∫≠p GPS trong c√†i ƒë·∫∑t tr√¨nh duy·ªát.";
          icon = 'üö´';
          break;
        case error.POSITION_UNAVAILABLE:
          message = "Kh√¥ng th·ªÉ x√°c ƒë·ªãnh v·ªã tr√≠. H√£y ki·ªÉm tra k·∫øt n·ªëi GPS v√† th·ª≠ l·∫°i.";
          icon = 'üì°';
          break;
        case error.TIMEOUT:
          message = "H·∫øt th·ªùi gian ch·ªù l·∫•y v·ªã tr√≠ GPS. H√£y th·ª≠ l·∫°i ho·∫∑c di chuy·ªÉn ra ngo√†i tr·ªùi.";
          icon = '‚è∞';
          break;
        default:
          message = "L·ªói kh√¥ng x√°c ƒë·ªãnh khi l·∫•y v·ªã tr√≠ GPS.";
          break;
      }
      
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = `
        <div class="status">
          ${icon} L·ªói ƒë·ªãnh v·ªã GPS
        </div>
        <p>${message}</p>
        <div style="margin-top: 15px; padding: 15px; background: #fff3cd; border-radius: 8px; color: #856404;">
          <strong>üí° G·ª£i √Ω:</strong>
          <ul style="margin: 10px 0; padding-left: 20px;">
            <li>Cho ph√©p truy c·∫≠p v·ªã tr√≠ trong tr√¨nh duy·ªát</li>
            <li>Di chuy·ªÉn ra ngo√†i tr·ªùi ƒë·ªÉ t√≠n hi·ªáu GPS t·ªët h∆°n</li>
            <li>T·∫Øt WiFi ƒë·ªÉ bu·ªôc d√πng GPS thay v√¨ WiFi positioning</li>
            <li>Ch·ªù v√†i ph√∫t ƒë·ªÉ GPS "kh·ªüi ƒë·ªông"</li>
          </ul>
        </div>
      `;
      
      updateStatus(`${icon} L·ªói: ${message}`, 'error');
      enableButtons();
    }

    function getHighAccuracyLocation() {
      if (!navigator.geolocation) {
        updateStatus('‚ùå Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ GPS', 'error');
        return;
      }
      
      updateStatus('üõ∞Ô∏è ƒêang k·∫øt n·ªëi GPS v·ªõi ƒë·ªô ch√≠nh x√°c cao...', 'loading', true);
      disableButtons();
      
      navigator.geolocation.getCurrentPosition(
        (position) => {
          displayLocationInfo(position);
          updateStatus('üéØ ƒê√£ l·∫•y ƒë∆∞·ª£c v·ªã tr√≠ GPS!', 'success');
          enableButtons();
        },
        handleLocationError,
        highAccuracyOptions
      );
    }

    function watchLocation() {
      if (!navigator.geolocation) {
        updateStatus('‚ùå Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ GPS', 'error');
        return;
      }
      
      if (isWatching) {
        // D·ª´ng theo d√µi
        navigator.geolocation.clearWatch(watchId);
        isWatching = false;
        document.getElementById('btnWatch').innerHTML = 'üì° Theo d√µi li√™n t·ª•c';
        updateStatus('‚èπÔ∏è ƒê√£ d·ª´ng theo d√µi v·ªã tr√≠', 'info');
        enableButtons();
        return;
      }
      
      // B·∫Øt ƒë·∫ßu theo d√µi
      updateStatus('üì° ƒêang theo d√µi v·ªã tr√≠ li√™n t·ª•c...', 'loading', true);
      isWatching = true;
      document.getElementById('btnWatch').innerHTML = '‚èπÔ∏è D·ª´ng theo d√µi';
      
      watchId = navigator.geolocation.watchPosition(
        (position) => {
          displayLocationInfo(position);
          updateStatus('üì° ƒêang theo d√µi v·ªã tr√≠... (Nh·∫•n "D·ª´ng theo d√µi" ƒë·ªÉ ng·ª´ng)', 'success');
        },
        handleLocationError,
        watchOptions
      );
    }

    function clearResults() {
      if (isWatching) {
        navigator.geolocation.clearWatch(watchId);
        isWatching = false;
        document.getElementById('btnWatch').innerHTML = 'üì° Theo d√µi li√™n t·ª•c';
      }
      
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = `
        <div class="status">
          üîç S·∫µn s√†ng l·∫•y v·ªã tr√≠ GPS ch√≠nh x√°c
        </div>
        <p>Nh·∫•n n√∫t "L·∫•y v·ªã tr√≠ GPS" ƒë·ªÉ b·∫Øt ƒë·∫ßu ƒë·ªãnh v·ªã v·ªõi ƒë·ªô ch√≠nh x√°c cao.</p>
      `;
      resultsDiv.className = 'info-card';
      enableButtons();
    }

    function disableButtons() {
      document.getElementById('btnGetLocation').disabled = true;
    }

    function enableButtons() {
      document.getElementById('btnGetLocation').disabled = false;
    }

    // Ki·ªÉm tra h·ªó tr·ª£ GPS khi t·∫£i trang
    document.addEventListener('DOMContentLoaded', function() {
      if (!navigator.geolocation) {
        updateStatus('‚ùå Tr√¨nh duy·ªát n√†y kh√¥ng h·ªó tr·ª£ GPS', 'error');
        document.getElementById('btnGetLocation').disabled = true;
        document.getElementById('btnWatch').disabled = true;
      }
    });
  </script>
</body>
</html>